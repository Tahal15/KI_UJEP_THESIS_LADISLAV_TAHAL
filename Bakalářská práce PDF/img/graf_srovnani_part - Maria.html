<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <title>Kompletní porovnání výkonu databází</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            text-align: center;
            color: #333;
        }

        h2 {
            margin-bottom: 5px;
            font-size: 22px;
        }

        p {
            margin-top: 0;
            color: #666;
            font-size: 14px;
        }

        /* Omezení šířky pro formát A4 / Bakalářskou práci */
        .container {
            position: relative;
            margin: auto;
            width: 100%;
            max-width: 800px;
            /* Cca šířka textu na A4 */
        }
    </style>
</head>

<body>

    <h2>Porovnání výkonu databází (včetně optimalizace)</h2>
    <p><em>Logaritmická stupnice (čas v sekundách). Méně je lépe.</em></p>

    <div class="container">
        <canvas id="myChart"></canvas>
    </div>

    <script>
        Chart.register(ChartDataLabels);

        const ctx = document.getElementById('myChart').getContext('2d');

        const data = {
            labels: [
                'Agregace s 1 JOIN',
                'Agregace přes čas',
                'Více JOIN s filtrem',
                'Agregace přes 2 dim.',
                'Komplexní dotaz (CTE)'
            ],
            datasets: [
                // --- Původní databáze ---
                {
                    label: 'ClickHouse',
                    data: [0.27, 0.33, 0.57, 0.65, 0.33],
                    backgroundColor: '#4BC0C0',
                    borderColor: '#4BC0C0',
                    borderWidth: 1
                },
                {
                    label: 'MSSQL (Řádkový)',
                    data: [0.52, 1.50, 0.25, 0.75, 0.55],
                    backgroundColor: '#C9CBCF',
                    borderColor: '#C9CBCF',
                    borderWidth: 1
                },
                {
                    label: 'MSSQL (Sloupcový)',
                    data: [0.42, 1.33, 0.04, 0.50, 0.65],
                    backgroundColor: '#A0A2A8',
                    borderColor: '#606266',
                    borderWidth: 1
                },
                // --- MariaDB Varianty ---
                {
                    label: 'MariaDB (Řádkový)',
                    data: [125.0, 0.32, 18.0, 105.0, 142.0],
                    backgroundColor: '#FFB3CC', // Světle růžová
                    borderColor: '#FFB3CC',
                    borderWidth: 1
                },
                {
                    label: 'MariaDB (Sloupcový)',
                    data: [2.49, 3.07, 1.59, 5.63, 2.83],
                    backgroundColor: '#FF6384', // Tmavší růžová/červená
                    borderColor: '#D43F60',
                    borderWidth: 1
                },
                // --- NOVÉ DATA (Optimalizace) ---
                {
                    label: 'MariaDB (Covering IDX)',
                    data: [15.0, 3.70, 1.90, 6.87, 3.28],
                    backgroundColor: '#36A2EB', // Modrá pro kontrast
                    borderColor: '#36A2EB',
                    borderWidth: 1,
                    // Zvýraznění v legendě (volitelné)
                    borderWidth: 2
                },
                // --- Ostatní ---
                {
                    label: 'PostgreSQL',
                    data: [7.39, 8.71, 6.10, 8.69, 4.86],
                    backgroundColor: '#FF9F40',
                    borderColor: '#FF9F40',
                    borderWidth: 1
                },
                {
                    label: 'TimescaleDB',
                    data: [6.71, 9.02, 5.63, 9.54, 12.00],
                    backgroundColor: '#FFCD56',
                    borderColor: '#FFCD56',
                    borderWidth: 1
                }
            ]
        };

        const config = {
            type: 'bar',
            data: data,
            options: {
                responsive: true,
                // Důležité pro BP: Zachovat poměr stran, aby graf nebyl roztažený
                maintainAspectRatio: true,
                aspectRatio: 1.6, // Poměr stran (širší než vyšší, ale ne moc)

                layout: {
                    padding: {
                        top: 30
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            boxWidth: 10,
                            font: { size: 10 },
                            padding: 10
                        }
                    },
                    tooltip: {
                        enabled: true,
                        mode: 'index',
                        intersect: false
                    },
                    datalabels: {
                        anchor: 'end',
                        align: 'end',
                        rotation: -90,
                        offset: 0,
                        color: '#333',
                        font: {
                            weight: 'bold',
                            size: 9 // Menší font, aby se to tam vešlo
                        },
                        formatter: function (value) {
                            // Zobrazit jen číslo, pokud je to více než 0.01, jinak skrýt pro přehlednost
                            return value;
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            font: { size: 11 }
                        }
                    },
                    y: {
                        type: 'logarithmic',
                        title: {
                            display: true,
                            text: 'Čas [s] (Log)',
                            font: { size: 11 }
                        },
                        ticks: {
                            callback: function (value, index, values) {
                                if (value === 100 || value === 10 || value === 1 || value === 0.1 || value === 0.01) {
                                    return value;
                                }
                            },
                            font: { size: 10 }
                        }
                    }
                },
                // Tady nastavujeme "kompaktnost" sloupců
                categoryPercentage: 0.85, // Šířka skupiny sloupců (méně mezer mezi skupinami)
                barPercentage: 0.95       // Šířka jednotlivých sloupců uvnitř skupiny (méně mezer mezi sloupci)
            }
        };

        new Chart(ctx, config);
    </script>

</body>

</html>