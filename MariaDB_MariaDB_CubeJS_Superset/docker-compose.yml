version: "3.9"

services:
  # ---------- Cube Store ----------
  cubestore:
    image: cubejs/cubestore:latest
    container_name: cubestore
    ports:
      - "3030:3030"
    environment:
      CUBESTORE_REMOTE_DIR: /cube/data
    volumes:
      - cubestore-data:/cube/data

  # ---------- Cube API ----------
  cube:
    image: cubejs/cube:latest
    container_name: cube
    depends_on:
      - cubestore
    ports:
      - "4000:4000"   # REST / GraphQL
      - "15432:15432" # Postgre-SQL wire-protocol (SQL API)
    volumes:
      - ./cubejs:/cube/conf          # tvoje *.js modely
    environment:
      # --- Production režim ---
      CUBEJS_DEV_MODE: "false"
      NODE_ENV: production
      CUBEJS_API_SECRET: MY_SUPER_SECRET_KEY

      # --- Propojení na Cube Store ---
      CUBEJS_CUBESTORE_HOST: cubestore

      # --- Zapnutí SQL API + přihlašovací údaje ---
      CUBEJS_PG_SQL_PORT: 15432      # port, na kterém má SQL API poslouchat
      CUBEJS_SQL_USER: root         # uživatel pro Superset
      CUBEJS_SQL_PASSWORD: tohlejeroothesloprobakalarku2025

      # --- Připojení k databázi (dosaď své hodnoty) ---
      CUBEJS_DB_TYPE: mysql          # nebo postgres, mssql…
      CUBEJS_DB_HOST: host.docker.internal
      CUBEJS_DB_PORT: "3307"
      CUBEJS_DB_NAME: mttgueries
      CUBEJS_DB_USER: root
      CUBEJS_DB_PASS: tohlejeroothesloprobakalarku2025

  # ---------- Superset ----------
  superset:
    image: apache/superset:latest
    container_name: superset
    depends_on:
      - cube
    ports:
      - "8088:8088"
    environment:
      SUPERSET_LOAD_EXAMPLES: "no"
      SUPERSET_SECRET_KEY: this_is_a_super_secret_key_1234567890
    volumes:
      - ./superset/superset_config.py:/app/pythonpath/superset_config.py
      - superset_data:/app/superset_home

volumes:
  cubestore-data:
  superset_data:
